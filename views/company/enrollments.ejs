<div class="container">
    <header class="mb-20" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <div>
            <h1>Student Enrollments</h1>
            <p style="color: #666;">Manage training plans for <strong><%= tenant.name %></strong></p>
        </div>
        <a href="<%= tenantUrl('/dashboard') %>" class="btn">Back to Dashboard</a>
    </header>

    <section class="card mb-30" style="border-top: 4px solid var(--primary-color);">
        <h2 style="margin-bottom: 20px;">Assign New Training Plan</h2>
        <form action="<%= tenantUrl('/enrollments/add') %>" method="POST">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
                <div>
                    <label>Select Student</label>
                    <select name="studentId" required>
                        <option value="">-- Choose Student --</option>
                        <% students.forEach(s => { %>
                            <option value="<%= s._id %>"><%= s.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div>
                    <label>Assign Trainer</label>
                    <select name="trainerId" required>
                        <option value="">-- Choose Trainer --</option>
                        <% trainers.forEach(t => { %>
                            <option value="<%= t._id %>"><%= t.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div>
                    <label>Assign Vehicle</label>
                    <select name="vehicleId" required>
                        <option value="">-- Choose Vehicle --</option>
                        <% vehicles.forEach(v => { %>
                            <option value="<%= v._id %>"><%= v.name %> (<%= v.plateNumber %>)</option>
                        <% }) %>
                    </select>
                </div>
                <div>
                    <label>Total Plan Price (Fees)</label>
                    <input type="number" name="totalPrice" placeholder="e.g. 5000" required>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 20px;">
                <div>
                    <label>Plan Duration (Days)</label>
                    <input type="number" name="planDays" value="15" min="1" required>
                </div>
                <div>
                    <label>Start Date</label>
                    <input type="date" name="startDate" required>
                </div>
                <div>
                    <label>Start Time</label>
                    <input type="time" name="startTime" required>
                </div>
                <div>
                    <label>End Time</label>
                    <input type="time" name="endTime" required>
                </div>
            </div>

            <div style="margin-top: 20px; display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" name="skipSundays" id="skipSun" checked style="width: auto; margin: 0;">
                <label for="skipSun" style="margin: 0;">Skip Sundays</label>
            </div>

            <button type="submit" class="btn-success mt-20" style="padding: 12px 40px;">Generate Training Schedule</button>
        </form>
    </section>

    <section class="card">
        <h2>Active Training Plans</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Trainer</th>
                        <th>Plan Price</th>
                        <th>Progress</th>
                        <th style="text-align: right;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% enrollments.forEach(e => { %>
                        <tr>
                            <td><strong><%= e.studentId?.name %></strong></td>
                            <td><%= e.trainerId?.name %></td>
                            <td><strong>$<%= e.totalPrice?.toLocaleString() %></strong></td>
                            <td>
                                <% let progress = Math.round((e.completedDays / e.planDays) * 100); %>
                                <div style="background: #eee; border-radius: 10px; height: 8px; width: 100px; overflow: hidden;">
                                    <div style="background: var(--primary-color); height: 100%; width: <%= progress %>%;"></div>
                                </div>
                                <small><%= e.completedDays %> / <%= e.planDays %> Days</small>
                            </td>
                            <td style="text-align: right;">
                                <a href="<%= tenantUrl('/enrollments/progress/' + e._id) %>" class="btn" style="padding: 6px 15px; font-size: 0.8rem; background: var(--accent-color);">View Card</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <%- include('../partials/pagination') %>
    </section>
</div>