<div class="container">
    <header class="mb-20" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>School Analytics</h1>
            <p>Performance overview for <strong><%= tenant.name %></strong></p>
        </div>
        <a href="<%= tenantUrl('/dashboard') %>" class="btn">Back to Dashboard</a>
    </header>

    <section class="grid">
        <div class="card" style="text-align: center;">
            <small>Total Lessons</small>
            <h2 style="font-size: 2.5rem;"><%= stats.totalLessons || 0 %></h2>
        </div>
        <div class="card" style="text-align: center; border-bottom: 4px solid var(--success-color);">
            <small>Completion Rate</small>
            <h2 style="font-size: 2.5rem; color: var(--success-color);">
                <%= stats.completionRate || 0 %>%
            </h2>
        </div>
        <div class="card" style="text-align: center; border-bottom: 4px solid var(--danger-color);">
            <small>Cancelled Lessons</small>
            <h2 style="font-size: 2.5rem; color: var(--danger-color);">
                <%= stats.cancelledLessons || 0 %>
            </h2>
        </div>
    </section>

    <div class="grid">
        <section class="card">
            <h2>Trainer Workload</h2>
            <div class="table-container mt-20">
                <table>
                    <thead>
                        <tr>
                            <th>Trainer Name</th>
                            <th>Lessons</th>
                            <th>Workload %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (!stats.trainerStats || stats.trainerStats.length === 0) { %>
                            <tr><td colspan="3" class="text-center">No trainer data available yet.</td></tr>
                        <% } else { %>
                            <% stats.trainerStats.forEach(item => { %>
                                <tr>
                                    <td><strong><%= (item.trainer && item.trainer.name) ? item.trainer.name : 'Unknown' %></strong></td>
                                    <td><%= item.count %></td>
                                    <td style="width: 50%;">
                                        <% let percentage = stats.totalLessons > 0 ? (item.count / stats.totalLessons) * 100 : 0; %>
                                        <div style="background: #eee; border-radius: 10px; height: 10px; width: 100%;">
                                            <div style="background: var(--primary-color); height: 10px; border-radius: 10px; width: <%= percentage %>%;"></div>
                                        </div>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="card">
            <h2>Quick Insights</h2>
            <div style="margin-top: 15px;">
                <div class="mb-20">
                    <strong>Efficiency Status:</strong><br>
                    <% if (stats.totalLessons === 0) { %>
                        <span style="color: #888;">No data to calculate efficiency.</span>
                    <% } else if (stats.completionRate > 80) { %>
                        <span style="color: var(--success-color);">High Efficiency: Most lessons are being completed.</span>
                    <% } else if (stats.completionRate < 50) { %>
                        <span style="color: var(--danger-color);">Warning: High cancellation rate detected.</span>
                    <% } else { %>
                        <span style="color: var(--warning-color);">Stable: Operations are normal.</span>
                    <% } %>
                </div>
            </div>
        </section>
    </div>
</div>